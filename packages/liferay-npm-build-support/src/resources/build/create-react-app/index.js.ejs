var scriptsInjected = false;

module.exports = function(args) {
  if (!scriptsInjected) {
    if (window.webpackJsonp !== undefined) {
      throw new Error(
        "\n" +
        "It looks like there's already some webpack code registered in this\n" +
        "window, thus portlet '<%= pkgJson.name %>@<%= pkgJson.version %>' cannot be loaded because\n" + 
        "it would interfere with the existing one.\n" +
        "\n" +
        "This can be caused because you have placed more than one webpack\n" +
        "based portlet in the same page or because some portlet directly\n" +
        "exports webpack code (i.e.: it sets window.webpackJsonp variable).\n"
      );
    }

    var script;

    <% jsFiles.forEach(jsFile => { %>
    script = document.createElement("script");
    script.src = "/o<%= webContextPath %>/react-app/static/js/<%= jsFile %>";
    script.async = false;
    document.head.appendChild(script);
    <% }) %>
  
    scriptsInjected = true;
  }

  Liferay.Loader.require(
    'frontend-js-portlet-extender/webpack/registry', 
    function(registry) {
      registry = registry.default;
      registry.launchPortlet("<%= pkgJson.name %>@<%= pkgJson.version %>", args);
    }
  );
}
